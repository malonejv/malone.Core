name: Build Workflow
description: Build application
inputs:
   configuration:
     required: true
     default: 'Release'
   solution_path:
     required: true
     default: ''
   variables_dir:
     required: true
     default: ''
   token:
     required: true
     default: ''
outputs:
  version_number: 
    description: "Version number"
    value: ${{ steps.version_number.outputs.version_number }}

runs:
  using: "composite"
      
  steps:

  - uses: actions/checkout@v2
  
  - name: Setup MSBuild
    uses: microsoft/setup-msbuild@v1.1

  - name: Setup NuGet
    uses: NuGet/setup-nuget@v1.0.5

  - name: Add GitHub Source
    shell: pwsh
    run: nuget sources add -name "github" -Source https://nuget.pkg.github.com/malonejv/index.json -Username malonejv -Password ${{ inputs.token }}
    
  - name: Nuget Restore Core Packages
    shell: pwsh
    run:  nuget restore ${{ inputs.solution_path }}
    
  - name: Build malone.Core
    shell: pwsh
    run: msbuild ${{ inputs.solution_path }} /t:Build /p:Configuration=${{ inputs.configuration }}
  
  - name: Version Number
    shell: pwsh
    id: version_number
    run: |
         (Get-Content ${{ inputs.variables_dir }})
         $maloneCoreInfo = (Get-Content ${{ inputs.variables_dir }} | ConvertFrom-Json)
         echo "::set-output name=version_number::$maloneCoreInfo"
